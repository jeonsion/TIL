# IMU와 AHRS가 무엇인지 알아보자

자이로 센서는 크게 `IMU(관성측정장치)`와 `AHRS(센서 융합기)`로 나누어진다.

## IMU센서란

**관성 측정 장치(Inertial Measurement Unit)**

IMU는 다음 센서로 구성되어있다.

- 자이로스코프 : `각속도`(rad/s)를 측정하고 시간당 `몇 도`(degree)를 회전했느지 필요할 때 사용
- 가속도계 : `가속도`(m/s^2)를 측정하고 초기값을 계산할 때 `중력가속도를` 분해하여 얼마나 많이 기울어졌는지 측정, 또한 `속도와 이동거리를` 가속도를 `적분해서` 사용가능
- 지자기센서 : `지자기를` 측정한다. 자북을 기준으로 자기선속의 세기를 측정하여 `자북을 기준으로 얼마나 틀어졌는지` 측정

> 종류에 따라 자이로스코프 가속도계만 있는 6축센서가 있고, 자이로스코프와 가속도계, 지자기센서를 포함한 9축 센서가 있다.
> 

> IMU는 보정되지 않은 센서의 순수한 X, Y, Z축 각속도, 가속도, 지자기값 을 출력해 주고 Roll, Pitch, Yaw는 자기가 알아서 구해야 합니다.
> 

---

### 1) 가속도 센서

![Untitled](IMU%E1%84%8B%E1%85%AA%20AHRS%E1%84%80%E1%85%A1%20%E1%84%86%E1%85%AE%E1%84%8B%E1%85%A5%E1%86%BA%E1%84%8B%E1%85%B5%E1%86%AB%E1%84%8C%E1%85%B5%20%E1%84%8B%E1%85%A1%E1%86%AF%E1%84%8B%E1%85%A1%E1%84%87%E1%85%A9%E1%84%8C%E1%85%A1%207308035d1d9541adbd57ffff61304f26/Untitled.png)

센서에서 얻어지는 출력값인 `가속도를 적분하여` 물체의 `진행 방향에 대한 속도`를 계산할 수 있고, 이를 가공하여 `물체의 위치`를 알아낼 수 있다.

짧은 기간에 대한 오차는 작으나, 센서에서 얻은 가속도 값을 `적분하므로` 시간에 따라 **`오차가 누적`**
되는 단점이 있다. 때문에 `**GPS와 결합하여 보정`** 하는 방법이 대중적으로 사용된다.

> cf) 지상에서는 물체는 수직 하방으로 중력가속도만큼(-g) 힘을 받고 있다.
> 

만약 정지된 상태라면, **중력 방향으로 작용하는 힘을 계산하여 각 축의 방향으로 기울어진 각도를 계산**할 수 있다.

![https://velog.velcdn.com/images%2F717lumos%2Fpost%2F9fe0bc55-2edc-4b0b-b61b-d33667048fc0%2F%EA%B7%B8%EB%A6%BC2.png](https://velog.velcdn.com/images%2F717lumos%2Fpost%2F9fe0bc55-2edc-4b0b-b61b-d33667048fc0%2F%EA%B7%B8%EB%A6%BC2.png)

예를 들어 위 사진과 같이 y방향으로 45°기울었다고 하자. 그렇다면 기울어진 상태에서 중력 방향으로 G=0.707만큼의 힘이 작용하여 이것이 x축과 z축 방향으로 나뉘어 힘이 출력될 것이며, 이 비율을 arctan 계산을 통해 각도를 알 수 있는 것이다.

**`중력 외 가속이 있는 경`우**에는 가속도 센서만으로는 정확한 기울기를 알 수 없다. 중력 가속도와 이동에 의한 가속도 값이 구분이 안되기 때문이다.

그래서 이를 보정하기 위해 **`각속도 센서(자이로스코프)`** 를 이용한다.

### 2) 자이로스코프(가속도 센서를 보정해줌)

- roll: x축에 대한 회전 (머리 갸웃갸웃)
- pitch: y축에 대한 회전 (머리 끄덕끄덕)
- yaw: z축에 대한 회전 (머리 도리도리)

![Untitled](IMU%E1%84%8B%E1%85%AA%20AHRS%E1%84%80%E1%85%A1%20%E1%84%86%E1%85%AE%E1%84%8B%E1%85%A5%E1%86%BA%E1%84%8B%E1%85%B5%E1%86%AB%E1%84%8C%E1%85%B5%20%E1%84%8B%E1%85%A1%E1%86%AF%E1%84%8B%E1%85%A1%E1%84%87%E1%85%A9%E1%84%8C%E1%85%A1%207308035d1d9541adbd57ffff61304f26/Untitled%201.png)

자이로스코프는 중력을 이용하여 코리올리 힘을 검출한다.

> **코리올리 힘**
물체가 회전하고 있는 좌표계 위에 존재할 경우, 직선 방향으로 운동하도록 힘을 가했을 때 좌표계로 인하여 직선 운동이 아닌 회전을 한다.
> 

중력이 가해질 때 진동 속도가 변하는 것을 각속도로 계산해, 질량과 진동 속도를 통해 값을 측정하여 검출할 수 있다.

자이로스코프는 종류에 따라 정확도와 크기, 출력 형태가 다양한데, 일반적으로 `MEMS` 자이로스코프가 있으며, 대부분 회전 각속도를 측정한다.

샘플링 시간(Δt)마다 회전 각속도를 측정한다면 **`(회전각) = (각속도 측정값) X (샘플링 시간)`**
로 회전각을 구할 수 있다.

자이로스코프는 정지할 때 혹은 아주 짧은 시간에 움직일 때는 오차가 없다.

그러나 `움직일 때는` 측정되는 각속도가 노이즈 등에 의해 에러가 발생하는데, 이 오차가 `적분` 시에 누적된다면 **`시간이 지날수록 누적오차가 매우 커져`** 물체가 기울어진 각도 값이 실제와는 차이가 난다. 이 오차의 보상을 위해 **`지자기 센서`**를 활용한다.

### 3) 지자기센서(자이로센서를 보정해줌)

**`지자기` `센서`** 는 **`지구 자기장의 세기`(자기선속)와 `방향`(자북을 기준으로 틀어진 각도)**  을 측정하는 센서이다. 물체가 바라보는 방향이 북쪽 방향과 정렬되어 지구의 자기력선과 일치할 때 센서의 측정값이 최댓값·최솟값을 가진다.

> **`주변 전기장`, `자기장의 유무에` 따라 측정값이 달라질 수도**  있으므로 주의
> 

---

### INS란

INS(Inertial Navigation System), 직역하면 관성항법장치이다. 비행기나 우주선이 안전하게 목적지에 도달할 수 있도록 INS가 중요한 역할을 한다.
INS는 IMU를 활용하여 이동체의 위치를 분석하는 시스템이다. IMU가 자세측정만 한다면 INS는 자세측정 및 이동거리까지 분석하기 위해 필요한 시스템이다.

## AHRS란

AHRS는 위의 IMU모듈을 포함하여 MCU를 포함합니다. MCU에선 센서들의 데이터를 이용하여 보정과 필터링을 거친 정확한 Roll, Pitch, Yaw 값을 계산해 줍니다.

## Reference

[http://wiki.ros.org/myahrs_driver](http://wiki.ros.org/myahrs_driver)

[https://dulidungsil.tistory.com/entry/IMU-Inertial-Measurement-Unit](https://dulidungsil.tistory.com/entry/IMU-Inertial-Measurement-Unit)

[https://velog.io/@717lumos/Sensor-IMU의-개념-및-활용법](https://velog.io/@717lumos/Sensor-IMU%EC%9D%98-%EA%B0%9C%EB%85%90-%EB%B0%8F-%ED%99%9C%EC%9A%A9%EB%B2%95)